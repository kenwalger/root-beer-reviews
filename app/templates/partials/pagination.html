{% if pagination and pagination.total_items > 0 %}
<div class="mt-6 flex flex-col md:flex-row justify-between items-center gap-4">
    <!-- Per-page selector -->
    <div class="flex items-center gap-2">
        <label for="per_page" class="text-sm text-gray-600">Items per page:</label>
        <select id="per_page" name="per_page" 
                onchange="buildPaginationUrlAndNavigate({{ query_params|tojson|safe }}, null, this.value)"
                class="form-select text-sm">
            {% for option in [10, 20, 50, 100] %}
            <option value="{{ option }}" {% if pagination.per_page == option %}selected{% endif %}>{{ option }}</option>
            {% endfor %}
        </select>
    </div>
    
    <!-- Pagination info -->
    <div class="text-sm text-gray-600">
        Showing {{ pagination.start_item }} to {{ pagination.end_item }} of {{ pagination.total_items }} items
    </div>
    
    <!-- Pagination controls (only show if more than one page) -->
    {% if pagination.total_pages > 1 %}
    <nav class="flex items-center gap-2 flex-wrap justify-center">
        <!-- First page -->
        {% if pagination.has_prev %}
        <a href="{{ build_pagination_url(request.url.path, query_params, 1, None) }}" 
           class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
            First
        </a>
        {% else %}
        <span class="px-3 py-2 text-sm font-medium text-gray-400 bg-gray-100 border border-gray-300 rounded-md cursor-not-allowed">
            First
        </span>
        {% endif %}
        
        <!-- Previous page -->
        {% if pagination.has_prev %}
        <a href="{{ build_pagination_url(request.url.path, query_params, pagination.prev_page, None) }}" 
           class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
            Previous
        </a>
        {% else %}
        <span class="px-3 py-2 text-sm font-medium text-gray-400 bg-gray-100 border border-gray-300 rounded-md cursor-not-allowed">
            Previous
        </span>
        {% endif %}
        
        <!-- Page numbers -->
        {% for page_num in pagination.page_range %}
            {% if page_num == pagination.page %}
            <span class="px-3 py-2 text-sm font-medium text-white bg-sassafras border border-sassafras rounded-md">
                {{ page_num }}
            </span>
            {% else %}
            <a href="{{ build_pagination_url(request.url.path, query_params, page_num, None) }}" 
               class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                {{ page_num }}
            </a>
            {% endif %}
        {% endfor %}
        
        <!-- Next page -->
        {% if pagination.has_next %}
        <a href="{{ build_pagination_url(request.url.path, query_params, pagination.next_page, None) }}" 
           class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
            Next
        </a>
        {% else %}
        <span class="px-3 py-2 text-sm font-medium text-gray-400 bg-gray-100 border border-gray-300 rounded-md cursor-not-allowed">
            Next
        </span>
        {% endif %}
        
        <!-- Last page -->
        {% if pagination.has_next %}
        <a href="{{ build_pagination_url(request.url.path, query_params, pagination.total_pages, None) }}" 
           class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
            Last
        </a>
        {% else %}
        <span class="px-3 py-2 text-sm font-medium text-gray-400 bg-gray-100 border border-gray-300 rounded-md cursor-not-allowed">
            Last
        </span>
        {% endif %}
    </nav>
    {% endif %}
</div>
{% endif %}

<script>
function buildPaginationUrlAndNavigate(queryParams, page, perPage) {
    const params = new URLSearchParams();
    
    // Add existing query params
    for (const [key, value] of Object.entries(queryParams || {})) {
        if (value && value !== '') {
            params.append(key, value);
        }
    }
    
    // Override page if provided, otherwise reset to page 1 when changing per_page
    if (page !== null) {
        params.set('page', page);
    } else if (perPage !== null) {
        // When changing per_page, reset to page 1
        params.set('page', '1');
    } else if (!params.has('page')) {
        params.set('page', '1');
    }
    
    // Override per_page if provided
    if (perPage !== null) {
        params.set('per_page', perPage);
    }
    
    window.location.href = window.location.pathname + '?' + params.toString();
}
</script>

